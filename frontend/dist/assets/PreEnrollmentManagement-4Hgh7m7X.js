import{q as B,j as e,z as ce,v as de,r as a,B as w,T as r,P as ue,I as v,b as o}from"./index-ChLGGPnB.js";import{a as he,b as xe,c as me,d as N,T as c,e as je}from"./TableRow-Bv94r2FQ.js";import{C as G}from"./Chip-CPpXuheC.js";import{T as f}from"./Tooltip-DkoEVcvy.js";import{V as L}from"./Visibility-D8FQma8d.js";import{A as pe}from"./CheckCircle-FWKU5k5W.js";import{D as ve}from"./Delete-CdzyE4mA.js";import{D as u,a as h}from"./DialogContent-B0nUtc07.js";import{D as x}from"./DialogTitle-BG-6kbBZ.js";import{G as s}from"./Grid-KMxruX-y.js";import{D as g}from"./Divider-CoXMxGjM.js";import{D as m}from"./DialogActions-CfEBBWUm.js";import{T as W}from"./TextField-B5PNJU4g.js";import{S as fe,A as ge}from"./Snackbar-CFT1ACio.js";import"./useId-D090OfHX.js";import"./Popper-C9UGyYFP.js";import"./dividerClasses-OPpZWiEp.js";import"./useSlot-DSXKQtnu.js";const be=B(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),H=B(e.jsx("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download"),Ce=B(e.jsx("path",{d:"M14 8c0-2.21-1.79-4-4-4S6 5.79 6 8s1.79 4 4 4 4-1.79 4-4m3 2v2h6v-2zM2 18v2h16v-2c0-2.66-5.33-4-8-4s-8 1.34-8 4"}),"PersonRemove"),Ne=()=>{var U,V,M;const{requests:J,updateEnrollmentStatus:I,deleteEnrollment:K,unenrollStudent:Q}=ce(),{courses:A}=de(),[t,j]=a.useState(null),[X,d]=a.useState(!1),[Y,b]=a.useState(!1),[Z,C]=a.useState(!1),[_,D]=a.useState(!1),[$,y]=a.useState(!1),[E,T]=a.useState(""),[q,O]=a.useState(""),[ee,S]=a.useState(!1),[p,l]=a.useState({open:!1,message:"",severity:"success"}),te=n=>{j(n),d(!0)},P=n=>{j(n),C(!0)},ne=async()=>{if(t)try{await I(t.id,"approved",E),l({open:!0,message:"Enrollment request approved successfully",severity:"success"}),C(!1),d(!1),T("")}catch{l({open:!0,message:"Failed to approve enrollment request",severity:"error"})}},R=n=>{j(n),b(!0)},re=async()=>{if(t)try{await I(t.id,"rejected"),l({open:!0,message:"Enrollment request rejected",severity:"info"}),b(!1),d(!1),O("")}catch{l({open:!0,message:"Failed to reject enrollment request",severity:"error"})}},se=n=>{j(n),D(!0)},oe=async()=>{if(t)try{K(t.id),l({open:!0,message:"Enrollment record deleted successfully",severity:"success"}),D(!1),d(!1)}catch{l({open:!0,message:"Failed to delete enrollment record",severity:"error"})}},le=n=>{j(n),y(!0)},ie=async()=>{if(t)try{Q(t.id),l({open:!0,message:"Student unenrolled successfully",severity:"success"}),y(!1),d(!1)}catch{l({open:!0,message:"Failed to unenroll student",severity:"error"})}},z=n=>{const i={pending:{color:"warning",label:"PENDING"},approved:{color:"success",label:"APPROVED"},rejected:{color:"error",label:"REJECTED"}},k={color:"default",label:n.toUpperCase()};return i[n]||k},F=n=>{const i=window.document.createElement("a");i.href=n.url,i.download=n.name,window.document.body.appendChild(i),i.click(),window.document.body.removeChild(i)},ae=n=>{S(!0)};return e.jsxs(w,{sx:{p:3},children:[e.jsx(r,{variant:"h4",gutterBottom:!0,children:"Pre-enrollment Management"}),e.jsx(he,{component:ue,children:e.jsxs(xe,{children:[e.jsx(me,{children:e.jsxs(N,{children:[e.jsx(c,{children:"Student Name"}),e.jsx(c,{children:"Course"}),e.jsx(c,{children:"Submission Date"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(je,{children:J.map(n=>{var i;return e.jsxs(N,{children:[e.jsx(c,{children:n.name}),e.jsx(c,{children:((i=A.find(k=>k.id===n.courseId))==null?void 0:i.title)||n.courseId}),e.jsx(c,{children:new Date(n.createdAt).toLocaleDateString()}),e.jsx(c,{children:e.jsx(G,{...z(n.status)})}),e.jsxs(c,{children:[e.jsx(f,{title:"View Details",children:e.jsx(v,{onClick:()=>te(n),size:"small",children:e.jsx(L,{})})}),n.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(f,{title:"Approve",children:e.jsx(v,{onClick:()=>P(n),color:"success",size:"small",children:e.jsx(pe,{})})}),e.jsx(f,{title:"Reject",children:e.jsx(v,{onClick:()=>R(n),color:"error",size:"small",children:e.jsx(be,{})})})]}),n.status==="approved"&&e.jsx(f,{title:"Unenroll Student",children:e.jsx(v,{onClick:()=>le(n),color:"warning",size:"small",children:e.jsx(Ce,{})})}),e.jsx(f,{title:"Delete Record",children:e.jsx(v,{onClick:()=>se(n),color:"error",size:"small",children:e.jsx(ve,{})})})]})]},n.id)})})]})}),e.jsxs(u,{open:X,onClose:()=>d(!1),maxWidth:"md",fullWidth:!0,children:[e.jsxs(x,{children:[e.jsx(r,{variant:"h6",children:"Enrollment Request Details"}),e.jsx(G,{...z((t==null?void 0:t.status)||"pending"),sx:{mt:1}})]}),e.jsx(h,{children:t&&e.jsxs(s,{container:!0,spacing:3,sx:{mt:1},children:[e.jsxs(s,{item:!0,xs:12,children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Student Information"}),e.jsx(g,{sx:{mb:2}})]}),e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"subtitle2",children:"Full Name"}),e.jsx(r,{variant:"body1",gutterBottom:!0,children:t.name})]}),e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"subtitle2",children:"Email"}),e.jsx(r,{variant:"body1",gutterBottom:!0,children:t.email})]}),e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"subtitle2",children:"Phone"}),e.jsx(r,{variant:"body1",gutterBottom:!0,children:t.phone})]}),e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"subtitle2",children:"Date of Birth"}),e.jsx(r,{variant:"body1",gutterBottom:!0,children:new Date(t.dateOfBirth).toLocaleDateString()})]}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle2",children:"Address"}),e.jsx(r,{variant:"body1",gutterBottom:!0,children:t.address})]}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx(r,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"Guardian Information"}),e.jsx(g,{sx:{mb:2}})]}),e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"subtitle2",children:"Guardian Name"}),e.jsx(r,{variant:"body1",gutterBottom:!0,children:t.guardianName})]}),e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"subtitle2",children:"Guardian Phone"}),e.jsx(r,{variant:"body1",gutterBottom:!0,children:t.guardianPhone})]}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx(r,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"Course Information"}),e.jsx(g,{sx:{mb:2}})]}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle2",children:"Selected Course"}),e.jsx(r,{variant:"body1",gutterBottom:!0,children:((U=A.find(n=>n.id===t.courseId))==null?void 0:U.title)||t.courseId})]}),t.document&&e.jsxs(s,{item:!0,xs:12,children:[e.jsx(r,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"Documents"}),e.jsx(g,{sx:{mb:2}}),e.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(r,{variant:"subtitle2",children:["Submitted Document: ",t.document.name]}),e.jsxs(w,{sx:{display:"flex",gap:1},children:[e.jsx(o,{startIcon:e.jsx(L,{}),onClick:()=>ae(t.document),variant:"outlined",size:"small",children:"View"}),e.jsx(o,{startIcon:e.jsx(H,{}),onClick:()=>F(t.document),variant:"outlined",size:"small",children:"Download"})]})]})]}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx(r,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"Submission Details"}),e.jsx(g,{sx:{mb:2}})]}),e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"subtitle2",children:"Submission Date"}),e.jsx(r,{variant:"body1",gutterBottom:!0,children:new Date(t.createdAt).toLocaleString()})]}),e.jsxs(s,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"subtitle2",children:"Last Updated"}),e.jsx(r,{variant:"body1",gutterBottom:!0,children:new Date(t.updatedAt).toLocaleString()})]})]})}),e.jsxs(m,{children:[e.jsx(o,{onClick:()=>d(!1),children:"Close"}),(t==null?void 0:t.status)==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{onClick:()=>P(t),variant:"contained",color:"success",children:"Approve"}),e.jsx(o,{onClick:()=>R(t),variant:"contained",color:"error",children:"Reject"})]})]})]}),e.jsxs(u,{open:Y,onClose:()=>b(!1),children:[e.jsx(x,{children:"Reject Enrollment Request"}),e.jsx(h,{children:e.jsx(W,{autoFocus:!0,margin:"dense",label:"Reason for Rejection",fullWidth:!0,multiline:!0,rows:4,value:q,onChange:n=>O(n.target.value)})}),e.jsxs(m,{children:[e.jsx(o,{onClick:()=>b(!1),children:"Cancel"}),e.jsx(o,{onClick:re,color:"error",variant:"contained",children:"Confirm Reject"})]})]}),e.jsxs(u,{open:Z,onClose:()=>C(!1),children:[e.jsx(x,{children:"Approve Enrollment Request"}),e.jsx(h,{children:e.jsx(W,{autoFocus:!0,margin:"dense",label:"Feedback for Student (Optional)",fullWidth:!0,multiline:!0,rows:4,value:E,onChange:n=>T(n.target.value),placeholder:"Add any additional information or instructions for the student..."})}),e.jsxs(m,{children:[e.jsx(o,{onClick:()=>C(!1),children:"Cancel"}),e.jsx(o,{onClick:ne,color:"success",variant:"contained",children:"Approve Enrollment"})]})]}),e.jsxs(u,{open:ee,onClose:()=>S(!1),maxWidth:"lg",fullWidth:!0,children:[e.jsxs(x,{children:["Document Preview",e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:(V=t==null?void 0:t.document)==null?void 0:V.name})]}),e.jsx(h,{children:e.jsx(w,{sx:{width:"100%",height:"80vh"},children:e.jsx("iframe",{src:(M=t==null?void 0:t.document)==null?void 0:M.url,style:{width:"100%",height:"100%",border:"none"},title:"Document Preview"})})}),e.jsxs(m,{children:[e.jsx(o,{onClick:()=>S(!1),children:"Close"}),e.jsx(o,{startIcon:e.jsx(H,{}),onClick:()=>F(t==null?void 0:t.document),variant:"contained",children:"Download"})]})]}),e.jsxs(u,{open:_,onClose:()=>D(!1),children:[e.jsx(x,{children:"Delete Enrollment Record"}),e.jsxs(h,{children:[e.jsx(r,{children:"Are you sure you want to delete this enrollment record? This action cannot be undone."}),e.jsx(r,{variant:"body2",color:"error",sx:{mt:2},children:"Note: If the student is currently enrolled, this will also remove them from the course."})]}),e.jsxs(m,{children:[e.jsx(o,{onClick:()=>D(!1),children:"Cancel"}),e.jsx(o,{onClick:oe,color:"error",variant:"contained",children:"Delete Record"})]})]}),e.jsxs(u,{open:$,onClose:()=>y(!1),children:[e.jsx(x,{children:"Unenroll Student"}),e.jsxs(h,{children:[e.jsx(r,{children:"Are you sure you want to unenroll this student from the course?"}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"The enrollment record will be marked as rejected, and the student will need to re-enroll to join the course again."})]}),e.jsxs(m,{children:[e.jsx(o,{onClick:()=>y(!1),children:"Cancel"}),e.jsx(o,{onClick:ie,color:"warning",variant:"contained",children:"Unenroll Student"})]})]}),e.jsx(fe,{open:p.open,autoHideDuration:6e3,onClose:()=>l({...p,open:!1}),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(ge,{onClose:()=>l({...p,open:!1}),severity:p.severity,sx:{width:"100%"},children:p.message})})]})};export{Ne as default};
